<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para a Minha Amada Mariana</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;400&display=swap" rel="stylesheet">
    <!-- Biblioteca para animação de rolagem -->
    <script src="https://unpkg.com/scrollreveal"></script>
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #1a1a1a;
            color: #fce4ec; /* Rosinha bem claro */
        }
        .font-dancing {
            font-family: 'Dancing Script', cursive;
        }
        .romantic-red {
            color: #ff8a80; /* Vermelho/rosa carinho */
        }
        .container-box {
            background-color: rgba(40, 40, 40, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        .slideshow-container {
            position: relative;
            max-width: 360px; /* Reduzido para um melhor visual em retrato */
            margin: auto;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 2px solid #ff8a80;
            background-color: #000;
            cursor: grab;
            aspect-ratio: 9 / 16; /* Proporção 9:16 adicionada */
        }
        .slideshow-container:active {
            cursor: grabbing;
        }
        .slide { 
            display: none; 
            transition: opacity 0.5s ease-in-out;
            height: 100%; /* Garante que o slide ocupe todo o espaço */
        }
        .slide .slide-media { /* Classe comum para img e video */
            width: 100%;
            height: 100%; /* Ajustado para preencher o container */
            object-fit: cover;
            vertical-align: middle;
            user-select: none; /* Impede a seleção de imagem/vídeo ao arrastar */
        }
        .dots-container { text-align: center; padding: 10px; margin-top: 8px; }
        .dot { cursor: pointer; height: 12px; width: 12px; margin: 0 4px; background-color: #4d4d4d; border-radius: 50%; display: inline-block; transition: background-color 0.6s ease; }
        .active-dot, .dot:hover { background-color: #ff8a80; }
        .timer-box { background-color: rgba(255, 138, 128, 0.1); border: 1px solid rgba(255, 138, 128, 0.3); border-radius: 12px; padding: 1rem 1.5rem; text-align: center; backdrop-filter: blur(5px); }
        .timer-unit { font-size: 0.8rem; color: #f8bbd0; }
        .stat-number {
            font-weight: 700;
            color: #fff;
            font-size: 1.5rem;
        }
        textarea {
            background-color: rgba(0,0,0,0.3);
            border: 1px solid #ff8a80;
            color: #fce4ec;
        }
        textarea::placeholder {
            color: #f8bbd0;
        }
        .action-button {
            background-color: #ff8a80;
            color: #1a1a1a;
            transition: background-color 0.3s;
        }
        .action-button:hover {
            background-color: #f8bbd0;
        }
        .action-button:disabled {
            background-color: #4d4d4d;
            cursor: not-allowed;
        }
        #saved-message-display, #poem-display {
            background-color: rgba(255, 138, 128, 0.1);
            border-left: 4px solid #ff8a80;
            padding: 1rem;
            border-radius: 8px;
            font-style: italic;
            white-space: pre-wrap; /* Mantém as quebras de linha */
            text-align: left;
        }
        /* Classe para elementos a serem animados pela rolagem */
        .reveal {
            visibility: hidden;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-3xl mx-auto text-center space-y-8 pb-16">

        <!-- Spotify Player -->
        <div class="reveal">
            <h2 class="font-dancing text-4xl mb-4 romantic-red">A Nossa Trilha Sonora</h2>
            <iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/3bpNcH1SCEMn6zuynZGY5e?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
        </div>

        <!-- Nomes -->
        <h1 class="font-dancing text-6xl md:text-7xl romantic-red reveal">Mariana & Nycolas</h1>

        <!-- Slideshow de Vídeos e Fotos -->
        <div class="slideshow-container reveal">
            <div class="slide">
                <video src="assets/mari7.mp4" class="slide-media" muted loop playsinline draggable="false"></video>
            </div>
            <div class="slide">
                <video src="assets/mari6.mp4" class="slide-media" muted loop playsinline draggable="false"></video>
            </div>
            <div class="slide">
                <video src="assets/mari5.mp4" class="slide-media" muted loop playsinline draggable="false"></video>
            </div>
            <div class="slide">
                <img src="assets/mari1.jpg" alt="Foto romântica de um casal 1" class="slide-media" draggable="false">
            </div>
            <div class="slide">
                <img src="assets/mari2.jpg" alt="Foto romântica de um casal 2" class="slide-media" draggable="false">
            </div>
            <div class="slide">
                <img src="assets/mari3.jpg" alt="Foto romântica de um casal 3" class="slide-media" draggable="false">
            </div>
            <div class="slide">
                <img src="assets/mari4.jpg" alt="Foto romântica de um casal 4" class="slide-media" draggable="false">
            </div>
        </div>
        <div class="dots-container reveal"></div>

        <!-- Cronómetro do Amor -->
        <div class="reveal">
            <h2 class="font-dancing text-4xl mb-4 romantic-red">O Nosso Tempo Juntos</h2>
            <div id="timer" class="timer-box grid grid-cols-3 sm:grid-cols-7 gap-2 md:gap-4 text-white"></div>
        </div>

        <!-- Fase da Lua -->
        <div class="container-box reveal">
            <h3 class="font-dancing text-3xl mb-3 romantic-red">A Lua do Nosso Dia</h3>
            <p class="text-lg">No dia 14 de Maio de 2025, a lua estará assim:</p>
            <div id="moon-phase" class="text-6xl mt-4"></div>
            <p id="moon-phase-name" class="mt-2 text-xl"></p>
        </div>

        <!-- Jornada Cósmica -->
        <div class="container-box reveal space-y-4">
            <h3 class="font-dancing text-3xl mb-3 romantic-red">A Nossa Jornada Cósmica</h3>
            <p>Desde o nosso dia, já percorremos <span id="earth-distance" class="stat-number">0</span> km ao redor do Sol.</p>
            <p>Testemunhámos <span id="sunrises" class="stat-number">0</span> amanheceres juntos.</p>
            <p>E vimos <span id="full-moons" class="stat-number">0</span> luas cheias iluminarem o nosso amor.</p>
        </div>

        <!-- Inspiração Poética (CORRIGIDO) -->
        <div class="container-box reveal">
            <h3 class="font-dancing text-3xl mb-3 romantic-red">Inspiração Poética</h3>
            <p class="mb-4">Clique no botão abaixo para que a nossa história inspire um poema de amor único, criado especialmente para nós.</p>
            <button id="generate-poem-btn" class="action-button font-bold py-2 px-6 rounded-lg">✨ Gerar Poema de Amor</button>
            <div id="poem-display" class="mt-4" style="display: none;"></div>
        </div>

        <!-- Caixa de Mensagem -->
        <div class="container-box reveal">
            <h3 class="font-dancing text-3xl mb-3 romantic-red">Uma Mensagem para a Eternidade</h3>
            <div id="message-input-container">
                <textarea id="message-box" class="w-full p-3 rounded-lg h-28" placeholder="Escreva algo que sentiu ao ver esta surpresa..."></textarea>
                <button id="save-message-btn" class="action-button font-bold py-2 px-6 rounded-lg mt-4">Guardar no Coração</button>
            </div>
            <div id="saved-message-display" style="display: none;"></div>
            <p id="confirmation-message" class="text-lg romantic-red mt-4" style="display: none;">A sua mensagem foi guardada para sempre! ❤️</p>
        </div>
    </div>

    <script>
        // --- CONFIGURAÇÕES GERAIS ---
        const startDate = new Date(2025, 4, 14, 0, 0, 0); 
        const EARTH_SPEED_KPS = 29.78;
        const LUNAR_CYCLE_DAYS = 29.53;
        const MESSAGE_STORAGE_KEY = 'marianaSavedMessage';

        // --- LÓGICA DO SLIDESHOW ---
        let slideIndex = 0;
        const slideshowContainer = document.querySelector(".slideshow-container");
        const slides = document.querySelectorAll(".slide");
        const dotsContainer = document.querySelector(".dots-container");
        let autoSlideInterval;

        slides.forEach((_, i) => {
            const dot = document.createElement("span");
            dot.classList.add("dot");
            dot.setAttribute("data-index", i);
            dot.addEventListener("click", () => {
                showSlide(i);
                resetAutoSlide();
            });
            dotsContainer.appendChild(dot);
        });
        
        const dots = document.querySelectorAll(".dot");

        function showSlide(index) {
            slides.forEach(slide => {
                slide.style.display = "none";
                const video = slide.querySelector('video');
                if (video) video.pause();
            });

            dots.forEach(dot => dot.classList.remove("active-dot"));

            slideIndex = (index + slides.length) % slides.length;

            const activeSlide = slides[slideIndex];
            activeSlide.style.display = "block";
            dots[slideIndex].classList.add("active-dot");

            const activeVideo = activeSlide.querySelector('video');
            if (activeVideo) {
                activeVideo.play().catch(error => console.log("Autoplay impedido.", error));
            }
        }

        function nextSlide() { showSlide(slideIndex + 1); }
        function prevSlide() { showSlide(slideIndex - 1); }

        function resetAutoSlide() {
            clearInterval(autoSlideInterval);
            autoSlideInterval = setInterval(nextSlide, 5000);
        }

        showSlide(0);
        resetAutoSlide();

        // --- LÓGICA DE DESLIZE (SWIPE) ---
        let touchStartX = 0;
        let touchEndX = 0;

        slideshowContainer.addEventListener('touchstart', (event) => {
            touchStartX = event.changedTouches[0].screenX;
        }, { passive: true });

        slideshowContainer.addEventListener('touchend', (event) => {
            touchEndX = event.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            if (touchEndX < touchStartX - swipeThreshold) {
                nextSlide();
                resetAutoSlide();
            }
            if (touchEndX > touchStartX + swipeThreshold) {
                prevSlide();
                resetAutoSlide();
            }
        }

        // --- LÓGICA DO CRONÓMETRO E CÁLCULOS CÓSMICOS ---
        const timerElement = document.getElementById('timer');
        const earthDistanceEl = document.getElementById('earth-distance');
        const sunrisesEl = document.getElementById('sunrises');
        const fullMoonsEl = document.getElementById('full-moons');
        function getDaysInMonth(year, month) { return new Date(year, month + 1, 0).getDate(); }
        function updateAllCounters() {
            const now = new Date();
            const distance = now.getTime() - startDate.getTime();
            if (distance < 0) {
                timerElement.innerHTML = `<div class="col-span-full text-2xl font-dancing romantic-red">A contar os segundos para o nosso começo... ❤️</div>`;
                earthDistanceEl.textContent = "0";
                sunrisesEl.textContent = "0";
                fullMoonsEl.textContent = "0";
                return;
            }
            let years = now.getFullYear() - startDate.getFullYear();
            let months = now.getMonth() - startDate.getMonth();
            let days = now.getDate() - startDate.getDate();
            if (days < 0) { months--; days += getDaysInMonth(now.getFullYear(), now.getMonth() - 1); }
            if (months < 0) { years--; months += 12; }
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            const milliseconds = (distance % 1000).toString().padStart(3, '0');
            timerElement.innerHTML = `<div><span class="text-3xl md:text-4xl font-bold">${years}</span><div class="timer-unit">Anos</div></div><div><span class="text-3xl md:text-4xl font-bold">${months}</span><div class="timer-unit">Meses</div></div><div><span class="text-3xl md:text-4xl font-bold">${days}</span><div class="timer-unit">Dias</div></div><div><span class="text-3xl md:text-4xl font-bold">${hours.toString().padStart(2, '0')}</span><div class="timer-unit">Horas</div></div><div><span class="text-3xl md:text-4xl font-bold">${minutes.toString().padStart(2, '0')}</span><div class="timer-unit">Minutos</div></div><div><span class="text-3xl md:text-4xl font-bold">${seconds.toString().padStart(2, '0')}</span><div class="timer-unit">Segundos</div></div><div class="col-span-3 sm:col-span-1"><span class="text-3xl md:text-4xl font-bold">${milliseconds}</span><div class="timer-unit">Milisegundos</div></div>`;
            const totalDaysPassed = distance / (1000 * 60 * 60 * 24);
            const totalSecondsPassed = distance / 1000;
            const earthDistance = totalSecondsPassed * EARTH_SPEED_KPS;
            const sunrisesCount = Math.floor(totalDaysPassed);
            const fullMoonsCount = Math.floor(totalDaysPassed / LUNAR_CYCLE_DAYS);
            earthDistanceEl.textContent = earthDistance.toLocaleString('pt-BR', { maximumFractionDigits: 0 });
            sunrisesEl.textContent = sunrisesCount;
            fullMoonsEl.textContent = fullMoonsCount;
        }
        setInterval(updateAllCounters, 47);
        updateAllCounters();

        // --- LÓGICA DA FASE DA LUA ---
        function getMoonPhase(year, month, day) {
            let c=0,e=0,jd=0,b=0;
            if(month<3){year--;month+=12;}
            month++;c=365.25*year;e=30.6*month;jd=c+e+day-694039.09;jd/=29.5305882;b=parseInt(jd);jd-=b;b=Math.round(jd*8);
            if(b>=8)b=0;
            const phases=[{emoji:"🌑",name:"Lua Nova"},{emoji:"🌒",name:"Lua Crescente"},{emoji:"🌓",name:"Quarto Crescente"},{emoji:"🌔",name:"Gibosa Crescente"},{emoji:"🌕",name:"Lua Cheia"},{emoji:"🌖",name:"Gibosa Minguante"},{emoji:"🌗",name:"Quarto Minguante"},{emoji:"🌘",name:"Lua Minguante"}];
            return phases[b];
        }
        const moonPhaseData = getMoonPhase(startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate());
        document.getElementById('moon-phase').textContent = moonPhaseData.emoji;
        document.getElementById('moon-phase-name').textContent = moonPhaseData.name;

        // --- LÓGICA DA CAIXA DE MENSAGEM ---
        const saveBtn = document.getElementById('save-message-btn');
        const messageBox = document.getElementById('message-box');
        const confirmationMsg = document.getElementById('confirmation-message');
        const messageInputContainer = document.getElementById('message-input-container');
        const savedMessageDisplay = document.getElementById('saved-message-display');
        function displaySavedMessage(){const savedMessage=localStorage.getItem(MESSAGE_STORAGE_KEY);if(savedMessage){savedMessageDisplay.textContent=savedMessage;savedMessageDisplay.style.display='block';messageInputContainer.style.display='none';}}
        saveBtn.addEventListener('click',()=>{const message=messageBox.value.trim();if(message!==''){localStorage.setItem(MESSAGE_STORAGE_KEY,message);confirmationMsg.style.display='block';displaySavedMessage();setTimeout(()=>{confirmationMsg.style.display='none';},5000);}});
        displaySavedMessage();

        // --- LÓGICA DO POEMA (CORRIGIDO) ---
        const generatePoemBtn = document.getElementById('generate-poem-btn');
        const poemDisplay = document.getElementById('poem-display');

        generatePoemBtn.addEventListener('click', () => {
            const poem = `Para Mariana e Nycolas,\n\nNo calendário, um dia marcou,\nOnde o tempo para vocês começou.\nA cada segundo, um novo passo,\nConstruindo juntos um eterno laço.\n\nSob o mesmo sol, tantos amanheceres,\nTestemunhas de um amor que só faz crescer.\nQue a vossa jornada, em estrelas traçada,\nSeja para sempre, abençoada.`;
            
            poemDisplay.textContent = poem;
            poemDisplay.style.display = 'block';
            generatePoemBtn.disabled = true; // Desativa o botão depois de usar
        });

        // --- LÓGICA DA ANIMAÇÃO DE ROLAGEM ---
        ScrollReveal().reveal('.reveal', {
            delay: 200,
            distance: '50px',
            origin: 'bottom',
            opacity: 0,
            easing: 'ease-in-out',
            interval: 150
        });
    </script>
</body>
</html>
